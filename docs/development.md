# 开发文档

## 项目概述

chatpro 是一套基于 React + Node.js 的聊天网页系统，支持移动端和桌面端，主界面布局参考 ChatGPT。系统同时面向两类用户：

- 角色体验型用户（情景人设卡）
- 专业能力型用户（专业人设卡）

默认游客可直接对话，所有本地聊天记录与偏好保存于浏览器本地。后台提供合规留档、运营数据、敏感词管理与模型配置等能力。数据库使用 SQLite。

## 技术栈

- 前端：React、TypeScript、Vite、CSS Variables
- 后端：Node.js、Express（或等价框架）
- 数据库：SQLite
- 本地存储：LocalStorage + IndexedDB（用于大体量对话）

## 环境要求

- Node.js 18+
- npm 或 pnpm

## 目录建议

```
chatpro/
  apps/
    web/                 # React 前端
    admin/               # 后台前端
  server/                # Node.js 后端
  docs/                  # 设计与接口文档
  packages/
    shared/              # 共享类型与工具
```

## 关键功能列表

### 前台聊天

- 首次打开出现主题选择：ChatGPT 风格、柔和主题、初音未来主题
- 默认游客可直接聊天
- 本地保存：会话、主题、人设、登录信息
- 人设卡：情景 / 专业
- 上传人设卡：本地使用；审核后可公开
- 修改人设将创建新对话
- 模型：普通 / 增强 / 专业
- 支持复制回答与编辑后重试
- 显示免责声明“内容由 AI 生成”

### 用户信息

- 点击登录按钮弹窗输入唯一字符串登录
- 校验后保存于本地
- 可设置并显示用户名
- 用户名、日期时间、地区等信息作为系统 prompt 注入
- 高级模型显示剩余对话次数

### 后台管理

- 账号密码登录
- 实时运营数据、趋势、并发、平均响应时间
- 敏感词、公告、日志、上游 API 配置
- 模型名称到模型 ID 映射
- 系统级 prompt 上限配置（按类型）
- IP 限流、IP 黑名单
- 用户与游客对话留档与导出
- 用户管理：用户 ID、标签、额度、聊天记录

## 数据安全与合规

- 游客对话默认仅本地存储
- 服务端存储用于合规审查与运营分析
- 支持导出访客 IP / UA / 对话记录

## 开发建议

- 前端交互优先做本地状态管理与缓存
- 角色卡与主题切换独立模块化
- 统一错误处理与限流提示
- 对话存储切分：最近会话本地、归档上报服务端
